machine:
  python:
    version: 3.5.1
  services:
    - postgresql
database:
  override:
    - createdb gleague_test
    - echo "CREATE USER genksta WITH UNENCRYPTED PASSWORD '1';" | psql -U postgres
    - echo "GRANT ALL privileges on database gleague_test to genksta" | psql -U postgres
dependencies:
  pre:
    - pip install ansible
    - go get github.com/dotabuff/manta
test:
  override:
    - py.test tests/*
deployment:
  push_to_server:
    branch: master
    commands:
      - ansible-playbook -i ./ansible-hosts ansible-playbook.yml:
          timeout: 1800
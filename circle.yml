machine:
  python:
    version: 3.5.1
  services:
    - postgresql
database:
  override:
    - createdb gleague_test
    - echo "CREATE USER genksta WITH UNENCRYPTED PASSWORD '1';" | psql -U postgres
    - echo "GRANT ALL privileges on database gleague_test to genksta" | psql -U postgres
dependencies:
  pre:
    - pip install --upgrade setuptools
    - pip install ansible
    - ansible-galaxy install gantsign.golang
    - go get github.com/dotabuff/manta
test:
  override:
    - py.test tests/*
deployment:
  push_to_server:
    branch: master
    commands:
      - git clone git@gitlab.com:Nuqlear/deploy.git
      - ansible-playbook -i hosts projects/genkstaleague/playbook.yml:
          pwd: deploy
          timeout: 1800

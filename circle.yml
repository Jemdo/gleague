machine:
  python:
    version: 3.5.1
  services:
    - postgresql
database:
  override:
    - createdb gleague_test
    - echo "CREATE USER genksta WITH UNENCRYPTED PASSWORD '1';" | psql -U postgres
    - echo "GRANT ALL privileges on database gleague_test to genksta" | psql -U postgres
dependencies:
  pre:
    - go get github.com/dotabuff/manta
test:
  pre:
    - cd dem2json && go build dem2json.go heroes.go parser.go 
  override:
    - py.test tests/*
deployment:
  push_to_server:
    branch: master
    commands:
      - ssh circleci@nuqlya.ddns.net -p 36000 'cd /home/circleci/proj/genkstaleague && git pull && /home/circleci/.virtualenvs/gleague/bin/pip install -r requirements.txt && alembic upgrade head && cd gleague/frontend/static/lib && bower install && supervisorctl restart gleague:':
          timeout: 1800